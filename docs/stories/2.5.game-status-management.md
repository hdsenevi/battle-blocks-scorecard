# Story 2.5: Game Status Management

## Status
Draft

## Story

**As a** user,
**I want** the system to distinguish between active and completed games,
**so that** I can see which games are still in progress and which are finished.

## Acceptance Criteria

1. **Given** games can be in different states (active, completed, paused)
2. **When** I view game lists or game details
3. **Then** the system correctly identifies:
   - Active games (status = "active") - games currently in progress
   - Completed games (status = "completed") - games that have ended with a winner
   - Paused games (status = "paused") - games that were interrupted
4. **And** active games can be resumed (Story 2.4)
5. **And** completed games cannot be modified or resumed
6. **And** the game status is displayed clearly in the UI
7. **And** the database correctly stores and retrieves game status
8. **And** game status transitions are handled correctly (active → completed when winner is determined)

**FRs covered:** FR7, FR40, FR44

## Tasks / Subtasks

- [ ] Verify database status field (AC: 7)
  - [ ] Ensure games table has status column (from Story 1.2)
  - [ ] Verify status values: "active", "completed", "paused"
  - [ ] Test database status storage and retrieval
- [ ] Implement status display in UI (AC: 3, 6)
  - [ ] Display status on main game screen
  - [ ] Display status in game lists
  - [ ] Use clear visual indicators (colors, icons, text)
  - [ ] Make status accessible (screen reader support)
- [ ] Implement status-based game access (AC: 4, 5)
  - [ ] Allow resume for active games
  - [ ] Prevent resume for completed games
  - [ ] Prevent score entry for completed games
  - [ ] Show appropriate UI based on status
- [ ] Implement status transition logic (AC: 8)
  - [ ] Handle active → completed transition (when winner determined)
  - [ ] Handle active → paused transition (when app backgrounded)
  - [ ] Update database when status changes
  - [ ] Update GameContext when status changes
- [ ] Add status filtering (AC: 2, 3)
  - [ ] Filter active games for resume
  - [ ] Filter completed games for history
  - [ ] Use database service listActiveGames(), listCompletedGames()

## Dev Notes

### Project Context
This story ensures proper game status management throughout the app. Games can be active, completed, or paused, and the system must handle status transitions correctly.

### Source Tree Information
- **Database service**: `services/database.ts` - Status storage and retrieval
- **Game Context**: `contexts/GameContext.tsx` - Status in game state
- **Game Reducer**: `reducers/gameReducer.ts` - Status update actions
- **Game status component**: `components/game/GameStatus.tsx` - Status display component
- **Main game screen**: `app/game/[id]/index.tsx` - Where status is displayed

### Architecture References
- **Status Values**: "active", "completed", "paused"
- **Status Storage**: Stored in games table status column
- **Status Transitions**: 
  - active → completed (when winner determined)
  - active → paused (when app backgrounded)
  - paused → active (when resumed)
- **Status-based Logic**: Different behavior based on game status

### Dependencies
- Requires Story 1.2 (Database Schema) to be completed
- Requires Story 1.3 (Database Service) to be completed
- Requires Story 1.6 (Game Context) to be completed
- Integrates with Story 2.4 (Resume Game)
- Integrates with Story 5.1 (Winner Announcement) for completion

### Testing

**Test File Location:**
- `services/__tests__/database.test.ts` - Status storage/retrieval tests
- `components/game/__tests__/GameStatus.test.tsx` - Status display tests

**Test Standards:**
- Test status storage in database
- Test status retrieval from database
- Test status display in UI
- Test status-based access control
- Test status transitions
- Test filtering by status
- Mock database service

**Testing Frameworks:**
- Jest for unit testing
- React Native Testing Library for component testing

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-14 | 1.0 | Story created from Epic 2 | PM Agent |

## Dev Agent Record

### Agent Model Used
_To be populated by Dev Agent_

### Debug Log References
_To be populated by Dev Agent_

### Completion Notes List
_To be populated by Dev Agent_

### File List
_To be populated by Dev Agent_

## QA Results
_To be populated by QA Agent_
