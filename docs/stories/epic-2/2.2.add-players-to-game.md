# Story 2.2: Add Players to Game

## Status
Draft

## Story

**As a** user,
**I want** to add players to a game (minimum 2, no maximum),
**so that** all participants can be tracked in the game.

## Acceptance Criteria

1. **Given** I am on the new game setup screen (Story 2.1)
2. **When** I enter a player name and tap "Add Player"
3. **Then** the player is added to the game with:
   - Initial score of 0
   - consecutive_misses set to 0
   - is_eliminated set to false
4. **And** the player is saved to the database with the game_id
5. **And** the player appears in the player list on screen
6. **And** I can add additional players (no maximum limit)
7. **And** the "Start Game" button is enabled only when at least 2 players are added (FR2)
8. **And** if I try to start with less than 2 players, I see a clear error message
9. **And** player names are validated (not empty, reasonable length)
10. **And** the UI provides visual feedback when a player is added

**FRs covered:** FR2, FR3, FR24, FR26

## Tasks / Subtasks

- [ ] Create player input form (AC: 2)
  - [ ] Add input field for player name
  - [ ] Add "Add Player" button
  - [ ] Style according to design system
  - [ ] Ensure accessibility (labels, screen reader support)
- [ ] Implement player name validation (AC: 9)
  - [ ] Validate name is not empty
  - [ ] Validate name length (reasonable maximum)
  - [ ] Show validation errors clearly
  - [ ] Prevent invalid names from being added
- [ ] Implement add player functionality (AC: 3, 4, 5)
  - [ ] Call database service addPlayer() function
  - [ ] Set initial score to 0
  - [ ] Set consecutive_misses to 0
  - [ ] Set is_eliminated to false
  - [ ] Save player to database with game_id
  - [ ] Update player list display
- [ ] Update GameContext with new player (AC: 3)
  - [ ] Dispatch ADD_PLAYER action to GameContext
  - [ ] Update game state with new player
  - [ ] Ensure state sync with database
- [ ] Implement player list display (AC: 5)
  - [ ] Display all added players
  - [ ] Show player names clearly
  - [ ] Allow removing players (optional enhancement)
  - [ ] Follow design system
- [ ] Implement "Start Game" button logic (AC: 7, 8)
  - [ ] Enable button only when 2+ players added
  - [ ] Show error message if trying to start with < 2 players
  - [ ] Navigate to main game screen when enabled and tapped
- [ ] Add visual feedback (AC: 10)
  - [ ] Show success feedback when player added
  - [ ] Update UI immediately
  - [ ] Provide haptic feedback (optional)

## Dev Notes

### Project Context
This story implements player management for new games. Users can add players with validation, and the system enforces the minimum 2 players requirement.

### Source Tree Information
- **New game screen**: `app/game/new.tsx` - Player addition interface
- **Database service**: `services/database.ts` - Used to save players
- **Game Context**: `contexts/GameContext.tsx` - Used to update game state
- **Game Reducer**: `reducers/gameReducer.ts` - Handles ADD_PLAYER action
- **Validation utilities**: `utils/validation.ts` - Player name validation

### Architecture References
- **State Management**: GameContext with ADD_PLAYER action
- **Database Integration**: Uses database service addPlayer() function
- **Validation**: Input validation utilities for player names
- **Minimum Players**: 2 players required (FR2)
- **No Maximum**: No limit on maximum players

### Dependencies
- Requires Story 2.1 (Create New Game Flow) to be completed
- Requires Story 1.3 (Database Service) to be completed
- Requires Story 1.6 (Game Context) to be completed

### Testing

**Test File Location:**
- `app/__tests__/game/new.test.tsx` - New game screen tests
- `utils/__tests__/validation.test.ts` - Validation tests

**Test Standards:**
- Test player name input and validation
- Test adding players to game
- Test database save for players
- Test GameContext state update
- Test "Start Game" button enable/disable logic
- Test minimum 2 players requirement
- Test error messages
- Test visual feedback
- Mock database service

**Testing Frameworks:**
- Jest for unit testing
- React Native Testing Library for component testing

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-14 | 1.0 | Story created from Epic 2 | PM Agent |

## Dev Agent Record

### Agent Model Used
_To be populated by Dev Agent_

### Debug Log References
_To be populated by Dev Agent_

### Completion Notes List
_To be populated by Dev Agent_

### File List
_To be populated by Dev Agent_

## QA Results
_To be populated by QA Agent_
