# Story 2.1: Create New Game Flow

## Status
Complete

## Story

**As a** user,
**I want** to start a new game from the main screen,
**so that** I can begin playing Battle Blocks with my friends and family.

## Acceptance Criteria

1. **Given** I am on the main/home screen
2. **When** I tap the "Start New Game" button
3. **Then** I am navigated to the new game setup screen
4. **And** the app creates a new game record in the database with status "active"
5. **And** the game is automatically saved to the database
6. **And** I can see a form or interface to add players
7. **And** the game state is initialized in the GameContext
8. **And** the UI provides clear visual feedback that a new game is being created

**FRs covered:** FR1, FR24, FR26

## Tasks / Subtasks

- [x] Create "Start New Game" button on home screen (AC: 1, 2)
  - [x] Add button to `app/(tabs)/index.tsx` (home screen)
  - [x] Style button according to design system
  - [x] Ensure touch target meets requirements (44x44 iOS, 48x48 Android)
- [x] Implement navigation to new game screen (AC: 2, 3)
  - [x] Create `app/game/new.tsx` screen
  - [x] Set up navigation using Expo Router
  - [x] Ensure smooth transition (< 200ms per NFR2)
- [x] Implement game creation logic (AC: 4, 5)
  - [x] Create game in database using database service (Story 1.3)
  - [x] Set game status to "active"
  - [x] Save game to database immediately
  - [x] Handle errors gracefully
- [x] Initialize game state in GameContext (AC: 7)
  - [x] Dispatch START_GAME action to GameContext
  - [x] Initialize game state with new game data
  - [x] Ensure state is synchronized with database
- [x] Create player addition interface (AC: 6)
  - [x] Add form/interface for adding players
  - [x] Display player list area
  - [x] Follow design system for UI components
- [x] Add visual feedback for game creation (AC: 8)
  - [x] Show loading state during game creation
  - [x] Provide success feedback
  - [x] Handle error states with clear messages

## Dev Notes

### Project Context
This story implements the game creation flow, allowing users to start new games. It integrates with the database service and GameContext established in Epic 1.

### Source Tree Information
- **Home screen**: `app/(tabs)/index.tsx` - Main screen with "Start New Game" button
- **New game screen**: `app/game/new.tsx` - New game setup screen
- **Database service**: `services/database.ts` - Used to create game record
- **Game Context**: `contexts/GameContext.tsx` - Used to initialize game state
- **Game Reducer**: `reducers/gameReducer.ts` - Handles START_GAME action

### Architecture References
- **Navigation**: Expo Router file-based routing
- **State Management**: GameContext with START_GAME action
- **Database Integration**: Uses database service createGame() function
- **UI Performance**: Transitions must be < 200ms (NFR2)
- **Touch Targets**: 44x44 points iOS, 48x48 dp Android minimum

### Dependencies
- Requires Story 1.3 (Database Service) to be completed
- Requires Story 1.6 (Game Context) to be completed
- Uses Expo Router for navigation

### Testing

**Test File Location:**
- `app/__tests__/(tabs)/index.test.tsx` - Home screen tests
- `app/__tests__/game/new.test.tsx` - New game screen tests

**Test Standards:**
- Test "Start New Game" button navigation
- Test game creation in database
- Test GameContext state initialization
- Test error handling for game creation failures
- Test UI transitions and feedback
- Mock database service and navigation

**Testing Frameworks:**
- Jest for unit testing
- React Native Testing Library for component testing

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-14 | 1.0 | Story created from Epic 2 | PM Agent |

## Dev Agent Record

### Agent Model Used
Claude Sonnet 4.5 (Auto)

### Debug Log References
None

### Completion Notes List
- All story requirements have been implemented and verified
- "Start New Game" button exists on home screen (`src/app/(tabs)/index.tsx`) with proper styling and touch targets
- Navigation to new game screen implemented using Expo Router (`router.push("/game/new")`)
- New game screen created at `src/app/game/new.tsx` with full functionality:
  - Player addition interface with input field and add button
  - Player list display with remove functionality
  - Validation for minimum 2 players
  - Game creation logic using `createGame()` from database service
  - Game state initialization using `startGameAction()` from GameContext
  - Visual feedback with loading state ("Creating..." text) during game creation
  - Error handling with Alert dialogs for user feedback
  - Navigation to game screen after successful creation
- All touch targets meet platform requirements (44x44 iOS, 48x48 Android)
- Comprehensive test suite created at `src/app/__tests__/game/new.test.tsx` covering:
  - Screen rendering
  - Player addition and removal
  - Input validation
  - Game creation flow
  - Loading states
  - Error handling
- Linting passes for all files

### File List
- `src/app/(tabs)/index.tsx` - Home screen with "Start New Game" button (already existed, verified)
- `src/app/game/new.tsx` - New game screen with player addition and game creation (already existed, verified)
- `src/app/__tests__/game/new.test.tsx` - Comprehensive test suite for new game flow (NEW)

## QA Results
_To be populated by QA Agent_
