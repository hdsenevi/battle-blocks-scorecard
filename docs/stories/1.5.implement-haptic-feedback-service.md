# Story 1.5: Implement Haptic Feedback Service

## Status
Draft

## Story

**As a** developer,
**I want** to create a haptic feedback service that wraps Expo Haptics API,
**so that** haptic feedback is consistent across the app and meets the < 50ms trigger requirement.

## Acceptance Criteria

1. **Given** expo-haptics is installed in the project
2. **When** I use the haptic service
3. **Then** the service provides functions:
   - `triggerScoreEntry()` - Light impact haptic for normal score entry
   - `triggerPenalty()` - Medium/Strong impact haptic for 50+ penalty rule
   - `triggerCompletion()` - Success pattern haptic for game completion
   - `triggerError()` - Error haptic for invalid actions
4. **And** all haptic triggers complete within 50ms of function call (NFR7)
5. **And** the service is located at `services/haptics.ts` as per architecture
6. **And** haptic types match the requirements (light, medium, success pattern, error)
7. **And** the service handles platform differences gracefully (iOS vs Android)
8. **And** errors are handled gracefully if haptics are unavailable

**FRs covered:** FR34, FR35, FR36, FR37, NFR7

## Tasks / Subtasks

- [ ] Install expo-haptics dependency (AC: 1)
  - [ ] Add expo-haptics to package.json
  - [ ] Run package installation
- [ ] Create haptics.ts service file (AC: 5)
  - [ ] Create `services/haptics.ts`
  - [ ] Import Expo Haptics API
- [ ] Implement triggerScoreEntry() function (AC: 3)
  - [ ] Use light impact haptic type
  - [ ] Ensure function completes within 50ms
- [ ] Implement triggerPenalty() function (AC: 3)
  - [ ] Use medium or strong impact haptic type
  - [ ] Ensure function completes within 50ms
- [ ] Implement triggerCompletion() function (AC: 3)
  - [ ] Use success pattern haptic type
  - [ ] Ensure function completes within 50ms
- [ ] Implement triggerError() function (AC: 3)
  - [ ] Use error haptic type
  - [ ] Ensure function completes within 50ms
- [ ] Handle platform differences (AC: 7)
  - [ ] Detect platform (iOS vs Android)
  - [ ] Use platform-appropriate haptic patterns
  - [ ] Test on both platforms
- [ ] Add error handling (AC: 8)
  - [ ] Wrap haptic calls in try-catch
  - [ ] Handle gracefully if haptics unavailable
  - [ ] Log errors without breaking app flow
- [ ] Verify performance requirement (AC: 4)
  - [ ] Test that all functions complete within 50ms
  - [ ] Measure execution time if needed

## Dev Notes

### Project Context
This story implements haptic feedback service to provide tactile feedback for user actions. The service must be fast (< 50ms) and work consistently across iOS and Android platforms.

### Source Tree Information
- **Haptics service**: `services/haptics.ts` - Haptic feedback service wrapper
- **Test file**: `services/__tests__/haptics.test.ts` - Haptics service tests
- **Haptics constants**: `constants/haptics.ts` - Haptic pattern constants (if needed)

### Architecture References
- **Service Location**: `services/haptics.ts` as per architecture
- **Function Naming**: camelCase (e.g., `triggerScoreEntry()`, `triggerPenalty()`)
- **Performance Requirement**: All haptic triggers must complete within 50ms (NFR7)
- **Platform Handling**: Service must handle iOS and Android differences gracefully
- **Error Handling**: Graceful degradation if haptics unavailable

### Haptic Types
- **Score Entry**: Light impact (normal user action)
- **Penalty**: Medium/Strong impact (important rule trigger)
- **Completion**: Success pattern (game win)
- **Error**: Error haptic (invalid action)

### Dependencies
- Requires expo-haptics package
- Uses Platform API for platform detection

### Testing

**Test File Location:**
- `services/__tests__/haptics.test.ts` - Haptics service tests

**Test Standards:**
- Test all haptic trigger functions
- Test platform-specific behavior (iOS vs Android)
- Test error handling when haptics unavailable
- Test performance (verify < 50ms execution time)
- Mock expo-haptics for unit testing
- Test graceful degradation

**Testing Frameworks:**
- Jest for unit testing
- Mock expo-haptics and Platform API
- Performance testing to verify < 50ms requirement

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-14 | 1.0 | Story created from Epic 1 | PM Agent |

## Dev Agent Record

### Agent Model Used
_To be populated by Dev Agent_

### Debug Log References
_To be populated by Dev Agent_

### Completion Notes List
_To be populated by Dev Agent_

### File List
_To be populated by Dev Agent_

## QA Results
_To be populated by QA Agent_
