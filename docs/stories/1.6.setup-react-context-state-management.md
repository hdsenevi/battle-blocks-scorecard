# Story 1.6: Set Up React Context State Management

## Status
Draft

## Story

**As a** developer,
**I want** to create GameContext with useReducer for game state management,
**so that** game state is centralized and can be accessed throughout the app.

## Acceptance Criteria

1. **Given** React Context and useReducer are available
2. **When** I set up the state management
3. **Then** the following are created:
   - `contexts/GameContext.tsx` with GameProvider component
   - `reducers/gameReducer.ts` with game state reducer
   - Type-safe action creators for state mutations
   - State structure includes: currentGame, players, gameStatus, leader
4. **And** the GameProvider wraps the app in the root layout
5. **And** state updates are immutable (never mutate existing state)
6. **And** the reducer handles actions: START_GAME, ADD_PLAYER, ADD_SCORE, APPLY_PENALTY, ELIMINATE_PLAYER, COMPLETE_GAME, RESUME_GAME
7. **And** TypeScript types are defined for GameState, GameAction, and all action payloads
8. **And** the context provides hooks for accessing state and dispatching actions

**FRs covered:** FR4, FR11, FR12, FR13, FR24, FR25

## Tasks / Subtasks

- [ ] Define TypeScript types for state management (AC: 7)
  - [ ] Create GameState interface with currentGame, players, gameStatus, leader
  - [ ] Create GameAction type with action types
  - [ ] Create action payload types for each action
- [ ] Create gameReducer.ts (AC: 3, 5, 6)
  - [ ] Create `reducers/gameReducer.ts`
  - [ ] Implement reducer function with all action handlers
  - [ ] Implement START_GAME action handler
  - [ ] Implement ADD_PLAYER action handler
  - [ ] Implement ADD_SCORE action handler
  - [ ] Implement APPLY_PENALTY action handler
  - [ ] Implement ELIMINATE_PLAYER action handler
  - [ ] Implement COMPLETE_GAME action handler
  - [ ] Implement RESUME_GAME action handler
  - [ ] Ensure all state updates are immutable
- [ ] Create GameContext.tsx (AC: 3, 8)
  - [ ] Create `contexts/GameContext.tsx`
  - [ ] Create GameProvider component with useReducer
  - [ ] Provide state and dispatch through context
  - [ ] Create custom hooks for accessing state and dispatch
- [ ] Integrate GameProvider in root layout (AC: 4)
  - [ ] Wrap app in GameProvider in `app/_layout.tsx`
  - [ ] Ensure provider is at root level
- [ ] Create action creators (AC: 3)
  - [ ] Create type-safe action creator functions
  - [ ] Export action creators for use in components

## Dev Notes

### Project Context
This story sets up the centralized state management for the game. All game state will be managed through React Context and useReducer pattern, providing a single source of truth.

### Source Tree Information
- **Game Context**: `contexts/GameContext.tsx` - React Context provider for game state
- **Game Reducer**: `reducers/gameReducer.ts` - Reducer function for game state updates
- **Test files**: 
  - `contexts/__tests__/GameContext.test.tsx` - Context tests
  - `reducers/__tests__/gameReducer.test.ts` - Reducer tests
- **Root layout**: `app/_layout.tsx` - Root layout where GameProvider is integrated

### Architecture References
- **State Management**: React Context + useReducer pattern
- **Context Location**: `contexts/GameContext.tsx`
- **Reducer Location**: `reducers/gameReducer.ts`
- **Immutability**: All state updates must be immutable (never mutate existing state)
- **Type Safety**: TypeScript types for GameState, GameAction, and action payloads
- **Action Types**: START_GAME, ADD_PLAYER, ADD_SCORE, APPLY_PENALTY, ELIMINATE_PLAYER, COMPLETE_GAME, RESUME_GAME

### State Structure
- **currentGame**: Current game instance data
- **players**: Array of players in the current game
- **gameStatus**: Status of the game (active/completed/paused)
- **leader**: Current leader/winner information

### Dependencies
- Uses React Context and useReducer (built-in React hooks)
- Will integrate with database service (Story 1.3) in future stories

### Testing

**Test File Location:**
- `contexts/__tests__/GameContext.test.tsx` - GameContext tests
- `reducers/__tests__/gameReducer.test.ts` - GameReducer tests

**Test Standards:**
- Test GameProvider provides state and dispatch
- Test all reducer actions (START_GAME, ADD_PLAYER, ADD_SCORE, etc.)
- Test state immutability (verify new objects created, not mutated)
- Test custom hooks for accessing state
- Test edge cases (empty state, invalid actions, etc.)
- Test action creators return correct action objects

**Testing Frameworks:**
- Jest for unit testing
- React Testing Library for context testing
- Mock React Context for isolated reducer testing

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-14 | 1.0 | Story created from Epic 1 | PM Agent |

## Dev Agent Record

### Agent Model Used
_To be populated by Dev Agent_

### Debug Log References
_To be populated by Dev Agent_

### Completion Notes List
_To be populated by Dev Agent_

### File List
_To be populated by Dev Agent_

## QA Results
_To be populated by QA Agent_
