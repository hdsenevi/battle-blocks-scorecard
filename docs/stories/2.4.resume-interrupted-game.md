# Story 2.4: Resume Interrupted Game

## Status
Draft

## Story

**As a** user,
**I want** to resume a previously saved game that was interrupted,
**so that** I can continue playing from where we left off.

## Acceptance Criteria

1. **Given** I have an active game that was previously saved
2. **When** I open the app
3. **Then** I see an option to "Continue Game" or "Resume Game" on the main screen
4. **And** when I tap the resume option
5. **Then** the game state is restored from the database:
   - All players with their current scores
   - Game status (active)
   - All score entries history
   - Game metadata (start time, date)
6. **And** I am taken to the main game screen with the restored game state
7. **And** game state restoration completes within 500ms (NFR4)
8. **And** if multiple active games exist, I can see a list to choose from
9. **And** the UI clearly indicates which game I am resuming
10. **And** if no active games exist, the resume option is not shown

**FRs covered:** FR5, FR6, FR25, FR28, FR29, NFR4

## Tasks / Subtasks

- [ ] Check for active games on app start (AC: 2, 10)
  - [ ] Query database for active games on app initialization
  - [ ] Use database service listActiveGames() function
  - [ ] Handle case when no active games exist
- [ ] Display resume option on home screen (AC: 3, 10)
  - [ ] Show "Continue Game" or "Resume Game" button if active games exist
  - [ ] Hide button if no active games
  - [ ] Style according to design system
- [ ] Implement single game resume (AC: 4, 5, 6)
  - [ ] Load game data from database
  - [ ] Load all players for the game
  - [ ] Load score entries history
  - [ ] Restore game state to GameContext
  - [ ] Navigate to main game screen
- [ ] Implement multiple games selection (AC: 8, 9)
  - [ ] Display list of active games if multiple exist
  - [ ] Show game metadata (date, time, player count)
  - [ ] Allow user to select which game to resume
  - [ ] Load selected game and restore state
- [ ] Restore game state to GameContext (AC: 5)
  - [ ] Dispatch RESUME_GAME action with game data
  - [ ] Update GameContext with all players and scores
  - [ ] Restore score entries history
  - [ ] Ensure state matches database
- [ ] Verify performance requirement (AC: 7)
  - [ ] Test restoration completes within 500ms
  - [ ] Optimize database queries if needed
  - [ ] Measure and verify performance
- [ ] Handle edge cases (AC: 5, 10)
  - [ ] Handle corrupted or incomplete game data
  - [ ] Handle games with missing players
  - [ ] Provide error feedback if restoration fails

## Dev Notes

### Project Context
This story implements game resumption functionality, allowing users to continue interrupted games. It integrates with app lifecycle handling (Story 1.7) and database service.

### Source Tree Information
- **Home screen**: `app/(tabs)/index.tsx` - Where resume option is displayed
- **Game resume logic**: Can be in hook `hooks/use-game.ts` or in component
- **Database service**: `services/database.ts` - Used to load active games
- **Game Context**: `contexts/GameContext.tsx` - Used to restore game state
- **Game Reducer**: `reducers/gameReducer.ts` - Handles RESUME_GAME action

### Architecture References
- **State Management**: GameContext with RESUME_GAME action
- **Database Integration**: Uses database service listActiveGames(), getGame(), getPlayersByGame()
- **Performance Requirement**: State restoration must complete within 500ms (NFR4)
- **App Lifecycle**: Integrates with Story 1.7 (App Lifecycle Handling)

### Dependencies
- Requires Story 1.3 (Database Service) to be completed
- Requires Story 1.6 (Game Context) to be completed
- Requires Story 1.7 (App Lifecycle Handling) to be completed
- Requires Story 2.3 (Main Game Screen) to be completed

### Testing

**Test File Location:**
- `app/__tests__/(tabs)/index.test.tsx` - Home screen resume tests
- `hooks/__tests__/use-game.test.ts` - Game resume hook tests (if using hook)

**Test Standards:**
- Test resume option display when active games exist
- Test resume option hidden when no active games
- Test single game resume
- Test multiple games selection
- Test game state restoration
- Test performance (verify < 500ms restoration)
- Test error handling
- Mock database service

**Testing Frameworks:**
- Jest for unit testing
- React Native Testing Library for component testing

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-14 | 1.0 | Story created from Epic 2 | PM Agent |

## Dev Agent Record

### Agent Model Used
_To be populated by Dev Agent_

### Debug Log References
_To be populated by Dev Agent_

### Completion Notes List
_To be populated by Dev Agent_

### File List
_To be populated by Dev Agent_

## QA Results
_To be populated by QA Agent_
