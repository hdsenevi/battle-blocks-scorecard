# Story 5.3: Prevent Further Score Entries After Completion

## Status
Draft

## Story

**As a** user,
**I want** the system to prevent score entries after a game is completed,
**so that** completed games cannot be modified.

## Acceptance Criteria

1. **Given** a game has been completed (Story 5.1)
2. **When** I try to enter a score for any player
3. **Then** the score entry interface is disabled or not accessible
4. **And** if I somehow attempt to enter a score, the system prevents it
5. **And** a clear message indicates the game is completed
6. **And** the game status remains "completed" in the database
7. **And** completed games cannot be resumed or modified
8. **And** a Maestro automation test flow is created in `.maestro/flows/` that:
    - Launches the app, creates a new game, adds at least 2 players, and navigates to the main game screen
    - Completes a game by having a player reach 50 points
    - Attempts to enter a score for any player after game completion
    - Verifies the score entry interface is disabled or not accessible
    - Verifies the system prevents score entry if attempted
    - Verifies a clear message indicates the game is completed
    - Verifies the game status remains "completed" in the database
    - Verifies completed games cannot be resumed or modified
    - The test flow is added to the automation regression suite

**FRs covered:** FR45

## Tasks / Subtasks

- [ ] Check game status before score entry (AC: 2, 3)
  - [ ] Verify game status is not "completed"
  - [ ] Disable score entry interface if completed
  - [ ] Hide or disable score entry buttons
- [ ] Prevent score entry at service level (AC: 4)
  - [ ] Add validation in score entry processing
  - [ ] Check game status before processing score
  - [ ] Reject score entries for completed games
- [ ] Display completion message (AC: 5)
  - [ ] Show clear message that game is completed
  - [ ] Explain why score entry is disabled
- [ ] Verify database status (AC: 6)
  - [ ] Ensure game status remains "completed"
  - [ ] Prevent status changes for completed games
- [ ] Prevent game modification (AC: 7)
  - [ ] Prevent resume for completed games
  - [ ] Prevent any modifications to completed games

## Dev Notes

### Project Context
This story ensures completed games cannot be modified, maintaining data integrity and game history.

### Source Tree Information
- **Score entry components**: Stories 3.2, 3.3 - Must check game status
- **Main game screen**: `app/game/[id]/index.tsx` - Disable score entry
- **Database service**: `services/database.ts` - Validate game status
- **Game Context**: `contexts/GameContext.tsx` - Game status check

### Architecture References
- **Status Check**: Verify game status before allowing actions
- **Data Integrity**: Prevent modifications to completed games
- **User Feedback**: Clear messages when actions are prevented

### Dependencies
- Requires Story 5.1 (Winner Announcement) to be completed
- Requires Stories 3.2 and 3.3 (Score Entry) to be modified
- Requires Story 2.5 (Game Status Management) to be completed

### Testing

**Test File Location:**
- Integration tests for completed game protection
- `components/game/__tests__/ScoreEntry.test.tsx` - Score entry disabled tests

**Test Standards:**
- Test score entry disabled for completed games
- Test service-level prevention
- Test completion message display
- Test database status protection
- Test game modification prevention
- Mock game status

**Testing Frameworks:**
- Jest for unit testing
- React Native Testing Library for component testing

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-14 | 1.0 | Story created from Epic 5 | PM Agent |

## Dev Agent Record

### Agent Model Used
_To be populated by Dev Agent_

### Debug Log References
_To be populated by Dev Agent_

### Completion Notes List
_To be populated by Dev Agent_

### File List
_To be populated by Dev Agent_

## QA Results
_To be populated by QA Agent_
