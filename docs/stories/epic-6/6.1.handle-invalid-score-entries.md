# Story 6.1: Handle Invalid Score Entries

## Status
Draft

## Story

**As a** user,
**I want** invalid score entries to be handled gracefully with clear error messages,
**so that** I understand what went wrong and can correct my input.

## Acceptance Criteria

1. **Given** I am entering a score (Stories 3.2, 3.3)
2. **When** I enter an invalid value (negative, zero, non-numeric, too large)
3. **Then** the system prevents the invalid entry
4. **And** a clear error message is displayed explaining what's wrong
5. **And** error haptic feedback is triggered (triggerError() from Story 1.5)
6. **And** the error message is accessible (screen reader announces it)
7. **And** I can correct my input and try again
8. **And** the app does not crash or lose game state (NFR16, NFR19)
9. **And** edge cases are handled (zero blocks, negative values, etc.)
10. **And** a Maestro automation test flow is created in `.maestro/flows/` that:
    - Launches the app, creates a new game, adds at least 2 players, and navigates to the main game screen
    - Opens the score entry interface for a player
    - Attempts to enter invalid values (negative, zero, non-numeric, too large)
    - Verifies the system prevents the invalid entry
    - Verifies a clear error message is displayed explaining what's wrong
    - Verifies error haptic feedback is triggered
    - Verifies the error message is accessible (screen reader announces it)
    - Verifies the user can correct input and try again
    - Verifies the app does not crash or lose game state
    - Verifies edge cases are handled (zero blocks, negative values, etc.)
    - The test flow is added to the automation regression suite

**FRs covered:** FR54, FR56, FR37, NFR16, NFR19

## Tasks / Subtasks

- [ ] Implement input validation (AC: 2, 3)
  - [ ] Validate numeric input
  - [ ] Reject negative values
  - [ ] Handle zero appropriately (miss, not error)
  - [ ] Reject non-numeric values
  - [ ] Validate reasonable maximum values
- [ ] Display error messages (AC: 4)
  - [ ] Show clear error message
  - [ ] Explain what's wrong
  - [ ] Style according to design system
- [ ] Trigger error haptic (AC: 5)
  - [ ] Call triggerError() from haptics service
  - [ ] Ensure haptic completes within 50ms
- [ ] Ensure accessibility (AC: 6)
  - [ ] Screen reader announces error
  - [ ] Proper semantic labels
- [ ] Allow input correction (AC: 7)
  - [ ] Keep input field accessible
  - [ ] Allow user to correct and retry
- [ ] Prevent crashes (AC: 8)
  - [ ] Handle errors gracefully
  - [ ] Preserve game state
  - [ ] No app crashes on invalid input
- [ ] Handle edge cases (AC: 9)
  - [ ] Zero blocks (handled as miss)
  - [ ] Negative values (rejected)
  - [ ] Very large numbers (validated)
  - [ ] Non-numeric (rejected)

## Dev Notes

### Project Context
This story implements robust error handling for invalid score entries, ensuring the app remains stable and provides clear feedback.

### Source Tree Information
- **Score entry components**: Stories 3.2, 3.3 - Input validation
- **Validation utilities**: `utils/validation.ts` - Input validation functions
- **Haptics service**: `services/haptics.ts` - triggerError() function
- **Error handling**: Error boundaries and try-catch blocks

### Architecture References
- **Input Validation**: Validate all user inputs
- **Error Handling**: Graceful error handling, no crashes
- **Haptics**: Error haptic feedback
- **Accessibility**: Screen reader support for errors
- **State Preservation**: Game state preserved on errors

### Dependencies
- Requires Stories 3.2 and 3.3 (Score Entry) to be completed
- Requires Story 1.5 (Haptics Service) to be completed

### Testing

**Test File Location:**
- `components/game/__tests__/ScoreEntry.test.tsx` - Invalid input tests
- `utils/__tests__/validation.test.ts` - Validation tests

**Test Standards:**
- Test invalid input rejection
- Test error message display
- Test haptic feedback
- Test accessibility
- Test input correction
- Test crash prevention
- Test edge cases
- Mock haptics service

**Testing Frameworks:**
- Jest for unit testing
- React Native Testing Library for component testing

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-14 | 1.0 | Story created from Epic 6 | PM Agent |

## Dev Agent Record

### Agent Model Used
_To be populated by Dev Agent_

### Debug Log References
_To be populated by Dev Agent_

### Completion Notes List
_To be populated by Dev Agent_

### File List
_To be populated by Dev Agent_

## QA Results
_To be populated by QA Agent_
