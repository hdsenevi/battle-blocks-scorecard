# Story 6.3: Handle Edge Cases in Score Calculation

## Status
Draft

## Story

**As a** user,
**I want** the system to handle edge cases gracefully,
**so that** unusual inputs don't break the game or cause errors.

## Acceptance Criteria

1. **Given** edge cases occur (zero blocks, negative values, very large numbers, etc.)
2. **When** the system processes these inputs
3. **Then** edge cases are handled gracefully:
   - Zero blocks: Handled as a miss (consecutive miss tracking)
   - Negative values: Rejected with clear error message
   - Very large numbers: Validated and rejected if unreasonable
   - Non-numeric inputs: Rejected with clear error message
4. **And** the app does not crash (NFR16)
5. **And** game state remains intact
6. **And** clear error messages guide the user
7. **And** the system recovers gracefully from edge cases
8. **And** a Maestro automation test flow is created in `.maestro/flows/` that:
    - Launches the app, creates a new game, adds at least 2 players, and navigates to the main game screen
    - Opens the score entry interface for a player
    - Tests zero blocks input and verifies it's handled as a miss (consecutive miss tracking)
    - Tests negative values input and verifies rejection with clear error message
    - Tests very large numbers input and verifies validation and rejection if unreasonable
    - Tests non-numeric inputs and verifies rejection with clear error message
    - Verifies the app does not crash
    - Verifies game state remains intact
    - Verifies clear error messages guide the user
    - Verifies the system recovers gracefully from edge cases
    - The test flow is added to the automation regression suite

**FRs covered:** FR56, NFR16

## Tasks / Subtasks

- [ ] Handle zero blocks (AC: 3)
  - [ ] Treat zero as miss (not error)
  - [ ] Trigger consecutive miss tracking
  - [ ] Don't reject zero, handle appropriately
- [ ] Handle negative values (AC: 3)
  - [ ] Reject negative values
  - [ ] Show clear error message
  - [ ] Trigger error haptic
- [ ] Handle very large numbers (AC: 3)
  - [ ] Validate reasonable maximum
  - [ ] Reject if unreasonable
  - [ ] Show clear error message
- [ ] Handle non-numeric inputs (AC: 3)
  - [ ] Reject non-numeric values
  - [ ] Show clear error message
  - [ ] Trigger error haptic
- [ ] Prevent crashes (AC: 4)
  - [ ] Handle all edge cases without crashing
  - [ ] Use try-catch blocks
  - [ ] Error boundaries if needed
- [ ] Preserve game state (AC: 5)
  - [ ] Don't lose game state on edge cases
  - [ ] Maintain data integrity
- [ ] Provide clear error messages (AC: 6)
  - [ ] Explain what went wrong
  - [ ] Guide user to correct input
- [ ] Ensure graceful recovery (AC: 7)
  - [ ] System recovers from edge cases
  - [ ] User can continue playing

## Dev Notes

### Project Context
This story ensures the app handles edge cases gracefully, preventing crashes and maintaining data integrity.

### Source Tree Information
- **Score entry components**: Stories 3.2, 3.3 - Edge case handling
- **Validation utilities**: `utils/validation.ts` - Edge case validation
- **Game rules service**: `services/gameRules.ts` - Edge case handling in calculations
- **Error handling**: Error boundaries and try-catch blocks

### Architecture References
- **Edge Case Handling**: Graceful handling of unusual inputs
- **Crash Prevention**: No crashes on edge cases (NFR16)
- **State Preservation**: Game state remains intact
- **Error Messages**: Clear guidance for users

### Dependencies
- Requires Stories 3.2 and 3.3 (Score Entry) to be completed
- Requires Story 1.4 (Game Rules Service) to be completed
- Requires Story 3.7 (Consecutive Miss Tracking) for zero handling

### Testing

**Test File Location:**
- `components/game/__tests__/ScoreEntry.test.tsx` - Edge case tests
- `services/__tests__/gameRules.test.ts` - Edge case calculation tests
- `utils/__tests__/validation.test.ts` - Edge case validation tests

**Test Standards:**
- Test zero blocks handling
- Test negative values rejection
- Test very large numbers validation
- Test non-numeric inputs rejection
- Test crash prevention
- Test state preservation
- Test error messages
- Test graceful recovery

**Testing Frameworks:**
- Jest for unit testing
- React Native Testing Library for component testing

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-14 | 1.0 | Story created from Epic 6 | PM Agent |

## Dev Agent Record

### Agent Model Used
_To be populated by Dev Agent_

### Debug Log References
_To be populated by Dev Agent_

### Completion Notes List
_To be populated by Dev Agent_

### File List
_To be populated by Dev Agent_

## QA Results
_To be populated by QA Agent_
