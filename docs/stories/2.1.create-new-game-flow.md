# Story 2.1: Create New Game Flow

## Status
Draft

## Story

**As a** user,
**I want** to start a new game from the main screen,
**so that** I can begin playing Battle Blocks with my friends and family.

## Acceptance Criteria

1. **Given** I am on the main/home screen
2. **When** I tap the "Start New Game" button
3. **Then** I am navigated to the new game setup screen
4. **And** the app creates a new game record in the database with status "active"
5. **And** the game is automatically saved to the database
6. **And** I can see a form or interface to add players
7. **And** the game state is initialized in the GameContext
8. **And** the UI provides clear visual feedback that a new game is being created

**FRs covered:** FR1, FR24, FR26

## Tasks / Subtasks

- [ ] Create "Start New Game" button on home screen (AC: 1, 2)
  - [ ] Add button to `app/(tabs)/index.tsx` (home screen)
  - [ ] Style button according to design system
  - [ ] Ensure touch target meets requirements (44x44 iOS, 48x48 Android)
- [ ] Implement navigation to new game screen (AC: 2, 3)
  - [ ] Create `app/game/new.tsx` screen
  - [ ] Set up navigation using Expo Router
  - [ ] Ensure smooth transition (< 200ms per NFR2)
- [ ] Implement game creation logic (AC: 4, 5)
  - [ ] Create game in database using database service (Story 1.3)
  - [ ] Set game status to "active"
  - [ ] Save game to database immediately
  - [ ] Handle errors gracefully
- [ ] Initialize game state in GameContext (AC: 7)
  - [ ] Dispatch START_GAME action to GameContext
  - [ ] Initialize game state with new game data
  - [ ] Ensure state is synchronized with database
- [ ] Create player addition interface (AC: 6)
  - [ ] Add form/interface for adding players
  - [ ] Display player list area
  - [ ] Follow design system for UI components
- [ ] Add visual feedback for game creation (AC: 8)
  - [ ] Show loading state during game creation
  - [ ] Provide success feedback
  - [ ] Handle error states with clear messages

## Dev Notes

### Project Context
This story implements the game creation flow, allowing users to start new games. It integrates with the database service and GameContext established in Epic 1.

### Source Tree Information
- **Home screen**: `app/(tabs)/index.tsx` - Main screen with "Start New Game" button
- **New game screen**: `app/game/new.tsx` - New game setup screen
- **Database service**: `services/database.ts` - Used to create game record
- **Game Context**: `contexts/GameContext.tsx` - Used to initialize game state
- **Game Reducer**: `reducers/gameReducer.ts` - Handles START_GAME action

### Architecture References
- **Navigation**: Expo Router file-based routing
- **State Management**: GameContext with START_GAME action
- **Database Integration**: Uses database service createGame() function
- **UI Performance**: Transitions must be < 200ms (NFR2)
- **Touch Targets**: 44x44 points iOS, 48x48 dp Android minimum

### Dependencies
- Requires Story 1.3 (Database Service) to be completed
- Requires Story 1.6 (Game Context) to be completed
- Uses Expo Router for navigation

### Testing

**Test File Location:**
- `app/__tests__/(tabs)/index.test.tsx` - Home screen tests
- `app/__tests__/game/new.test.tsx` - New game screen tests

**Test Standards:**
- Test "Start New Game" button navigation
- Test game creation in database
- Test GameContext state initialization
- Test error handling for game creation failures
- Test UI transitions and feedback
- Mock database service and navigation

**Testing Frameworks:**
- Jest for unit testing
- React Native Testing Library for component testing

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-14 | 1.0 | Story created from Epic 2 | PM Agent |

## Dev Agent Record

### Agent Model Used
_To be populated by Dev Agent_

### Debug Log References
_To be populated by Dev Agent_

### Completion Notes List
_To be populated by Dev Agent_

### File List
_To be populated by Dev Agent_

## QA Results
_To be populated by QA Agent_
