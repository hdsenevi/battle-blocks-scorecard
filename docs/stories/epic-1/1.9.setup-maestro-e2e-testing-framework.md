# Story 1.9: Set Up Maestro E2E Testing Framework

## Status
Draft

## Story

**As a** developer,
**I want** to set up Maestro for end-to-end testing,
**so that** I can test complete user journeys on simulators and emulators.

## Acceptance Criteria

1. **Given** the project uses Expo managed workflow
2. **When** I set up Maestro for E2E testing
3. **Then** the following are configured:
   - Maestro CLI installed and accessible
   - `.maestro/` directory created at project root
   - `.maestro/config.yaml` with basic configuration
   - `.maestro/flows/` directory for test flows
   - `.maestro/README.md` with setup and usage instructions
4. **And** Maestro can run tests against Expo development builds
5. **And** the configuration supports both iOS and Android platforms
6. **And** test flows can be executed locally via CLI
7. **And** documentation includes how to run E2E tests
8. **And** all interactive UI elements have `testID` attributes for reliable test selection

**FRs covered:** NFR22, NFR23, NFR24

## Tasks / Subtasks

- [ ] Install Maestro CLI (AC: 3)
  - [ ] Install Maestro CLI using: `curl -Ls "https://get.maestro.mobile.dev" | bash` (macOS/Linux)
  - [ ] Verify Maestro CLI is accessible via `maestro --version`
  - [ ] Add Maestro installation instructions to project README
- [ ] Create Maestro directory structure (AC: 3)
  - [ ] Create `.maestro/` directory at project root
  - [ ] Create `.maestro/flows/` directory for test flows
  - [ ] Create `.maestro/config.yaml` with basic configuration
  - [ ] Create `.maestro/README.md` with setup and usage instructions
- [ ] Configure Maestro for Expo (AC: 4)
  - [ ] Create `.maestro/config.yaml` with app configuration
  - [ ] Configure app bundle ID or package name
  - [ ] Configure for Expo development builds
  - [ ] Verify compatibility with Expo SDK ~54.0
- [ ] Configure platform support (AC: 5)
  - [ ] Configure iOS simulator support in config
  - [ ] Configure Android emulator support in config
  - [ ] Document platform-specific configuration if needed
- [ ] Set up test execution (AC: 6)
  - [ ] Document how to run E2E tests locally via CLI
  - [ ] Create example test flow file in `.maestro/flows/`
  - [ ] Verify test execution works on both platforms
- [ ] Document E2E testing (AC: 7)
  - [ ] Add E2E testing section to project README
  - [ ] Document Maestro setup process
  - [ ] Document how to write and run test flows
  - [ ] Document test execution commands
- [ ] Establish testID requirements (AC: 8)
  - [ ] Document testID attribute requirements for UI elements
  - [ ] Create checklist for adding testID to interactive elements
  - [ ] Update component development guidelines to include testID

## Dev Notes

### Project Context
This story establishes the E2E testing infrastructure using Maestro, which is the Expo-recommended E2E testing tool. Maestro provides YAML-based test flows that are easy to write and maintain, and it works seamlessly with Expo managed workflow.

### Source Tree Information
- **Maestro directory**: `.maestro/` at project root
- **Test flows**: `.maestro/flows/*.yaml`
- **Configuration**: `.maestro/config.yaml`
- **Documentation**: `.maestro/README.md`

### Architecture References
- **E2E Testing**: Maestro is the official Expo-recommended E2E testing tool
- **Test Organization**: See `docs/architecture/testing-strategy.md`
- **Expo Compatibility**: Maestro works with Expo managed workflow and EAS Build
- **Platform Support**: Maestro supports both iOS simulators and Android emulators

### Technical Implementation Notes

**Maestro CLI Installation:**
```bash
# macOS/Linux
curl -Ls "https://get.maestro.mobile.dev" | bash

# Verify installation
maestro --version
```

**Basic Maestro Config Structure:**
```yaml
# .maestro/config.yaml
appId: com.battleblocks.scorecard
```

**Example Test Flow Structure:**
```yaml
# .maestro/flows/example.yaml
appId: com.battleblocks.scorecard
---
- launchApp
- assertVisible: "Start New Game"
- tapOn: "Start New Game"
- assertVisible: "Add Player"
```

**Running Tests:**
```bash
# Run all flows
maestro test .maestro/flows/

# Run specific flow
maestro test .maestro/flows/example.yaml
```

### Dependencies
- Requires Expo development build (not Expo Go)
- Maestro CLI must be installed on development machine
- iOS Simulator or Android Emulator must be running

### Testing Requirements
- Verify Maestro CLI installation works
- Verify test flow can launch app
- Verify test flow can interact with UI elements
- Verify tests run on both iOS and Android

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-15 | 1.0 | Story created from Epic 1 | Architect Agent |

## Dev Agent Record

### Agent Model Used
_To be populated by Dev Agent_

### Debug Log References
_To be populated by Dev Agent_

### Completion Notes List
_To be populated by Dev Agent_

### File List
_To be populated by Dev Agent_

## QA Results
_To be populated by QA Agent_
