# Story 7.1: Dark Mode and Light Mode Theme Support

## Status
Draft

## Story

**As a** user,
**I want** the app to support both dark mode and light mode themes,
**so that** I can use the app comfortably in different lighting conditions and according to my system preferences.

## Acceptance Criteria

1. **Given** I have system theme preferences set (light or dark)
2. **When** I open the app
3. **Then** the app automatically detects and applies my system theme preference
4. **And** all UI elements (backgrounds, text, borders, buttons, cards) use theme-appropriate colors
5. **And** game state indicators (leader, eliminated, active) maintain visual distinction in both themes
6. **And** all text maintains WCAG AA contrast ratios in both themes (4.5:1 for normal text, 3:1 for large text)
7. **And** the theme persists across app restarts
8. **And** the app provides smooth transitions when switching themes
9. **And** all components use Tailwind color tokens (no hardcoded colors in JSX)
10. **And** the Tailwind config includes theme-aware color definitions for both light and dark modes
11. **And** automation tests are created:
    - Component tests verify theme detection and application
    - Component tests verify contrast ratios in both themes
    - Component tests verify game state indicators visible in both themes
    - Integration tests verify theme persistence across app restarts

**FRs covered:** NFR35, NFR36, NFR37, NFR38, NFR39, NFR40, NFR41

## Tasks / Subtasks

- [ ] Configure NativeWind for dark mode support (AC: 3, 10)
  - [ ] Enable dark mode in Tailwind config using `darkMode: 'media'` or `darkMode: 'class'`
  - [ ] Configure NativeWind to respect system theme preferences
  - [ ] Verify NativeWind v4+ dark mode compatibility with React Native/Expo
- [ ] Extend Tailwind config with dark mode color tokens (AC: 4, 5, 9, 10)
  - [ ] Add dark mode variants for all custom colors (primary, leader, eliminated, active, gray, link)
  - [ ] Define dark mode background colors (dark backgrounds instead of white)
  - [ ] Define dark mode text colors (light text instead of dark)
  - [ ] Define dark mode border colors (lighter borders for dark backgrounds)
  - [ ] Ensure game state colors maintain distinction in dark mode
  - [ ] Reference UX design spec color system for dark mode palette
- [ ] Update existing color tokens to support both themes (AC: 4, 9, 10)
  - [ ] Update `primary` colors with dark mode variants
  - [ ] Update `leader` colors with dark mode variants
  - [ ] Update `eliminated` colors with dark mode variants
  - [ ] Update `active` colors with dark mode variants
  - [ ] Update `gray` scale colors (border, border-medium, bg-light) with dark mode variants
  - [ ] Update `link` color with dark mode variant
- [ ] Update ThemedView component for dark mode (AC: 4)
  - [ ] Ensure ThemedView uses theme-aware colors from Tailwind
  - [ ] Verify ThemedView respects system theme preference
  - [ ] Test ThemedView in both light and dark modes
- [ ] Update all components to use theme-aware Tailwind classes (AC: 4, 9)
  - [ ] Replace hardcoded background colors with `bg-white dark:bg-gray-900` or theme tokens
  - [ ] Replace hardcoded text colors with `text-gray-900 dark:text-gray-100` or theme tokens
  - [ ] Replace hardcoded border colors with theme-aware border classes
  - [ ] Update all game components (PlayerCard, ScoreEntryModal, ScoreHistory, etc.)
  - [ ] Update all screen components (game screens, tabs, modals, etc.)
  - [ ] Ensure all buttons use theme-aware colors
  - [ ] Ensure all cards use theme-aware backgrounds and borders
- [ ] Verify game state indicators in dark mode (AC: 5)
  - [ ] Test leader indicator visibility in dark mode
  - [ ] Test eliminated player indicator visibility in dark mode
  - [ ] Test active player indicator visibility in dark mode
  - [ ] Ensure all indicators maintain visual distinction
  - [ ] Verify color coding supplemented with other indicators (icons, text) for accessibility
- [ ] Verify contrast ratios in both themes (AC: 6)
  - [ ] Test all text against backgrounds in light mode (WCAG AA: 4.5:1 normal, 3:1 large)
  - [ ] Test all text against backgrounds in dark mode (WCAG AA: 4.5:1 normal, 3:1 large)
  - [ ] Adjust colors if contrast ratios don't meet requirements
  - [ ] Document contrast ratios for both themes
- [ ] Implement theme persistence (AC: 7)
  - [ ] Store theme preference in AsyncStorage or similar
  - [ ] Load theme preference on app startup
  - [ ] Apply stored theme preference if available, otherwise use system preference
  - [ ] Test theme persistence across app restarts
- [ ] Add smooth theme transitions (AC: 8)
  - [ ] Implement smooth color transitions when switching themes
  - [ ] Use React Native Animated API or NativeWind transitions
  - [ ] Test theme switching performance
- [ ] Update constants/theme.ts for dark mode (AC: 4)
  - [ ] Review existing Colors.light and Colors.dark definitions
  - [ ] Ensure consistency with Tailwind config colors
  - [ ] Update if needed to match Tailwind theme tokens
  - [ ] Verify useThemeColor hook works with both themes
- [ ] Create component tests for theme support (AC: 11)
  - [ ] Test theme detection and application in components
  - [ ] Test contrast ratios in both themes
  - [ ] Test game state indicators visibility in both themes
  - [ ] Mock system theme preference for testing
- [ ] Create integration tests for theme persistence (AC: 11)
  - [ ] Test theme preference storage and retrieval
  - [ ] Test theme persistence across app restarts
  - [ ] Test fallback to system preference when no stored preference

## Dev Notes

### Previous Story Insights
- Story 6.6 (Accessibility Features Implementation) established WCAG AA contrast requirements and accessibility standards that must be maintained in both themes
- All components currently use Tailwind classes, making theme migration straightforward
- Existing `ThemedView` component and `useThemeColor` hook provide foundation for theme support
- `src/constants/theme.ts` already has light/dark color definitions that may need alignment with Tailwind config

### Data Models
No database schema changes required. Theme preference can be stored in AsyncStorage or similar local storage.

[Source: architecture/core-architectural-decisions.md#data-architecture]

### Component Specifications

**ThemedView Component:**
- Location: `src/components/themed-view.tsx`
- Currently uses `useThemeColor` hook with `Colors.light` and `Colors.dark`
- Needs to be updated to work seamlessly with NativeWind dark mode classes
- Should respect system theme preference automatically

[Source: existing codebase - src/components/themed-view.tsx]

**useThemeColor Hook:**
- Location: `src/hooks/useThemeColor.ts`
- Uses `useColorScheme` from React Native to detect system theme
- Returns appropriate color based on current theme
- May need updates to align with Tailwind theme tokens

[Source: existing codebase - src/hooks/useThemeColor.ts]

**useColorScheme Hook:**
- Location: `src/hooks/useColorScheme.ts`
- Re-exports `useColorScheme` from `react-native`
- Provides system theme detection capability

[Source: existing codebase - src/hooks/useColorScheme.ts]

### File Locations

**Tailwind Configuration:**
- File: `tailwind.config.js` (project root)
- Currently has custom colors defined (primary, leader, eliminated, active, gray, link)
- Needs dark mode variants added for all custom colors
- NativeWind preset already configured: `presets: [require("nativewind/preset")]`

[Source: existing codebase - tailwind.config.js]

**Theme Constants:**
- File: `src/constants/theme.ts`
- Contains `Colors.light` and `Colors.dark` definitions
- May need updates to align with Tailwind config colors
- Used by `useThemeColor` hook

[Source: existing codebase - src/constants/theme.ts]

**Components to Update:**
- All components in `src/components/game/` (PlayerCard, ScoreEntryModal, ScoreHistory)
- All components in `src/components/ui/` (if any)
- All screen components in `src/app/` (game screens, tabs, modals)
- ThemedView component: `src/components/themed-view.tsx`

[Source: architecture/core-architectural-decisions.md#component-architecture]

### Technical Constraints

**NativeWind Dark Mode:**
- NativeWind v4+ supports dark mode via Tailwind's `dark:` variant
- Can use `darkMode: 'media'` (system preference) or `darkMode: 'class'` (manual toggle)
- For system preference detection, use `darkMode: 'media'`
- Dark mode classes: `dark:bg-gray-900`, `dark:text-white`, etc.

[Source: NativeWind documentation and design system foundation]

**Color System from UX Design Spec:**
- Light mode: White backgrounds (#FFFFFF), Gray-900 text (#111827), Gray-200 borders (#E5E7EB)
- Dark mode: Should use dark backgrounds, light text, lighter borders
- Primary: Blue (#3B82F6) - works in both themes but may need adjustment for dark backgrounds
- Game state colors must maintain distinction in both themes
- All colors must meet WCAG AA contrast ratios (4.5:1 normal text, 3:1 large text)

[Source: docs/ux-design-specification/visual-design-foundation.md#color-system]

**Accessibility Requirements:**
- WCAG AA contrast ratios must be maintained in both themes
- Color coding must be supplemented with icons, text, and patterns (not just color)
- High contrast mode support through system settings
- All accessibility features from Story 6.6 must continue to work in both themes

[Source: docs/ux-design-specification/visual-design-foundation.md#accessibility-compliance]

### Testing Requirements

**Test File Location:**
- Component tests: `src/components/**/__tests__/*.test.tsx`
- Integration tests: `src/__tests__/theme-persistence.test.ts` (or similar)
- Test utilities: May need theme testing helpers

[Source: architecture/testing-strategy.md#test-organization-structure]

**Test Standards:**
- Use React Native Testing Library for component tests
- Mock `useColorScheme` hook to test both themes
- Verify contrast ratios programmatically or manually
- Test theme persistence with AsyncStorage mocks
- Test on both iOS and Android simulators/emulators

[Source: architecture/testing-strategy.md#layer-2-component-tests]

**Testing Frameworks:**
- Jest (v30.2.0) - Test runner
- React Native Testing Library (v13.3.3) - Component testing
- @testing-library/jest-native (v5.4.3) - React Native matchers

[Source: architecture/testing-strategy.md#tool-selection-rationale]

**Specific Test Cases:**
1. Component renders correctly in light mode
2. Component renders correctly in dark mode
3. Theme switches smoothly when system preference changes
4. All text meets contrast ratio requirements in both themes
5. Game state indicators (leader, eliminated, active) are visible in both themes
6. Theme preference persists across app restarts
7. Fallback to system preference when no stored preference exists

[Source: architecture/testing-strategy.md#testing-philosophy]

### Project Structure Notes

All file locations align with the established project structure:
- Components: `src/components/`
- Screens: `src/app/`
- Hooks: `src/hooks/`
- Constants: `src/constants/`
- Config: Root level (`tailwind.config.js`)

[Source: architecture/project-structure-boundaries.md]

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-15 | 1.0 | Story created from Epic 7 | Scrum Master |

## Dev Agent Record

### Agent Model Used
_To be populated by Dev Agent_

### Debug Log References
_To be populated by Dev Agent_

### Completion Notes List
_To be populated by Dev Agent_

### File List
_To be populated by Dev Agent_

## QA Results
_To be populated by QA Agent_
