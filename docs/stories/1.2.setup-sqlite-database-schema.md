# Story 1.2: Set Up SQLite Database Schema

## Status
Draft

## Story

**As a** developer,
**I want** to create the SQLite database schema with games, players, and score_entries tables,
**so that** game data can be persisted reliably with proper relational structure.

## Acceptance Criteria

1. **Given** expo-sqlite is installed in the project
2. **When** I initialize the database
3. **Then** the following tables are created with proper schema:
   - `games` table with columns: id (PRIMARY KEY), status (active/completed/paused), created_at, updated_at
   - `players` table with columns: id (PRIMARY KEY), game_id (FOREIGN KEY), name, current_score, consecutive_misses, is_eliminated, created_at
   - `score_entries` table with columns: id (PRIMARY KEY), player_id (FOREIGN KEY), game_id (FOREIGN KEY), score_value, entry_type (single_block/multiple_blocks), created_at
4. **And** all foreign key relationships are properly defined
5. **And** indexes are created for frequently queried columns (game_id, player_id, status)
6. **And** the schema follows snake_case naming convention as per architecture
7. **And** database initialization includes error handling for schema creation failures

**FRs covered:** FR24, FR26, FR27, FR28, FR29

## Tasks / Subtasks

- [ ] Install expo-sqlite dependency (AC: 1)
  - [ ] Add expo-sqlite to package.json
  - [ ] Run package installation
- [ ] Create database schema file (AC: 3, 6)
  - [ ] Create `database/schema.sql` with table definitions
  - [ ] Define `games` table with proper columns
  - [ ] Define `players` table with proper columns
  - [ ] Define `score_entries` table with proper columns
  - [ ] Use snake_case naming convention for all tables and columns
- [ ] Define foreign key relationships (AC: 4)
  - [ ] Add FOREIGN KEY constraint for players.game_id → games.id
  - [ ] Add FOREIGN KEY constraint for score_entries.player_id → players.id
  - [ ] Add FOREIGN KEY constraint for score_entries.game_id → games.id
- [ ] Create indexes for performance (AC: 5)
  - [ ] Create index on games.status (idx_games_status)
  - [ ] Create index on players.game_id (idx_players_game_id)
  - [ ] Create index on score_entries.player_id (idx_score_entries_player_id)
  - [ ] Create index on score_entries.game_id (idx_score_entries_game_id)
- [ ] Implement database initialization function (AC: 2, 7)
  - [ ] Create database initialization function in `services/database.ts`
  - [ ] Implement error handling for schema creation failures
  - [ ] Use `CREATE TABLE IF NOT EXISTS` pattern
- [ ] Create database types (AC: 3)
  - [ ] Define TypeScript interfaces for Game, Player, ScoreEntry
  - [ ] Create `database/types.ts` or add to `types/database.ts`

## Dev Notes

### Project Context
This story establishes the database foundation for persisting game data. The database uses SQLite via expo-sqlite with a relational structure.

### Source Tree Information
- **Database schema**: `database/schema.sql` - Initial database schema
- **Database service**: `services/database.ts` - Database operations service layer
- **Database types**: `types/database.ts` or `database/types.ts` - TypeScript type definitions
- **Migrations**: `database/migrations/` - Database migration files (future use)

### Architecture References
- **Naming Convention**: snake_case for tables and columns (e.g., `games`, `players`, `score_entries`, `game_id`, `current_score`, `created_at`)
- **Primary Keys**: Always `id` (INTEGER PRIMARY KEY AUTOINCREMENT)
- **Foreign Keys**: `{table}_id` format (e.g., `game_id`, `player_id`)
- **Indexes**: `idx_{table}_{column}` format (e.g., `idx_games_status`, `idx_players_game_id`)
- **Table Creation**: Use `CREATE TABLE IF NOT EXISTS` pattern
- **Queries**: Always use parameterized queries for security (to be implemented in Story 1.3)

### Database Schema Details
- **games table**: Tracks game sessions with status (active/completed/paused)
- **players table**: Tracks players within games with scores and elimination status
- **score_entries table**: Tracks individual score entries for audit/history

### Testing

**Test File Location:**
- `services/__tests__/database.test.ts` - Database initialization and schema tests

**Test Standards:**
- Test database initialization creates all tables correctly
- Test foreign key constraints are properly defined
- Test indexes are created
- Test error handling for schema creation failures
- Use test database instance for testing

**Testing Frameworks:**
- Jest for unit testing
- Mock expo-sqlite for testing

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-14 | 1.0 | Story created from Epic 1 | PM Agent |

## Dev Agent Record

### Agent Model Used
_To be populated by Dev Agent_

### Debug Log References
_To be populated by Dev Agent_

### Completion Notes List
_To be populated by Dev Agent_

### File List
_To be populated by Dev Agent_

## QA Results
_To be populated by QA Agent_
