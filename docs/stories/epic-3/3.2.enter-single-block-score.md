# Story 3.2: Enter Single Block Score

## Status
Draft

## Story

**As a** user,
**I want** to enter a score when a single block is knocked over,
**so that** the score equals the block number (e.g., block 12 = 12 points).

## Acceptance Criteria

1. **Given** I am on the score entry interface for a player (Story 3.1)
2. **When** I select "Single Block" and enter a block number (e.g., 12)
3. **Then** the score is calculated as the block number (12 points)
4. **And** the score is added to the player's current total
5. **And** the score entry is saved to the database with entry_type = "single_block"
6. **And** the score update appears instantly (< 100ms per NFR1)
7. **And** haptic feedback is triggered (light impact per Story 1.5)
8. **And** the main game screen updates to show the new score
9. **And** the score entry interface closes and returns to main game screen
10. **And** invalid inputs (negative, zero, non-numeric) are handled with clear error messages

**FRs covered:** FR8, FR9, FR13, FR23, FR34, NFR1, NFR7

## Tasks / Subtasks

- [ ] Implement single block input (AC: 2)
  - [ ] Add input field for block number
  - [ ] Validate input is numeric
  - [ ] Style according to design system
- [ ] Implement score calculation (AC: 3)
  - [ ] Use calculateScore() from gameRules service (Story 1.4)
  - [ ] Pass block number and isMultiple=false
  - [ ] Get calculated score value
- [ ] Update player score (AC: 4)
  - [ ] Add calculated score to player's current total
  - [ ] Update player in database using database service
  - [ ] Update GameContext with ADD_SCORE action
- [ ] Save score entry to database (AC: 5)
  - [ ] Call database service addScoreEntry()
  - [ ] Set entry_type = "single_block"
  - [ ] Save player_id, game_id, score_value, entry_type
- [ ] Trigger haptic feedback (AC: 7)
  - [ ] Call triggerScoreEntry() from haptics service (Story 1.5)
  - [ ] Ensure haptic completes within 50ms
- [ ] Update UI immediately (AC: 6, 8)
  - [ ] Update main game screen score display
  - [ ] Ensure update appears < 100ms
  - [ ] Use GameContext state for real-time updates
- [ ] Close score entry interface (AC: 9)
  - [ ] Close modal or navigate back
  - [ ] Return to main game screen
- [ ] Implement input validation (AC: 10)
  - [ ] Validate numeric input
  - [ ] Reject negative values
  - [ ] Reject zero (handled as miss in Story 3.7)
  - [ ] Show clear error messages
  - [ ] Trigger error haptic feedback

## Dev Notes

### Project Context
This story implements single block score entry, where the score equals the block number. It integrates with game rules service, database, and haptics.

### Source Tree Information
- **Score entry component**: `components/game/ScoreEntry.tsx` - Score entry interface
- **Game rules service**: `services/gameRules.ts` - calculateScore() function
- **Database service**: `services/database.ts` - addScoreEntry() function
- **Haptics service**: `services/haptics.ts` - triggerScoreEntry() function
- **Game Context**: `contexts/GameContext.tsx` - ADD_SCORE action
- **Game Reducer**: `reducers/gameReducer.ts` - Handles ADD_SCORE action

### Architecture References
- **Score Calculation**: Uses gameRules.calculateScore() with isMultiple=false
- **Database**: Saves entry_type = "single_block"
- **Performance**: Score update < 100ms (NFR1)
- **Haptics**: Light impact haptic for normal score entry
- **State Management**: GameContext ADD_SCORE action

### Dependencies
- Requires Story 3.1 (Score Entry Interface) to be completed
- Requires Story 1.4 (Game Rules Service) to be completed
- Requires Story 1.5 (Haptics Service) to be completed
- Requires Story 1.3 (Database Service) to be completed
- Requires Story 1.6 (Game Context) to be completed

### Testing

**Test File Location:**
- `components/game/__tests__/ScoreEntry.test.tsx` - Score entry tests
- Integration tests for score calculation flow

**Test Standards:**
- Test single block score calculation
- Test score addition to player total
- Test database save with correct entry_type
- Test haptic feedback trigger
- Test UI update performance (< 100ms)
- Test input validation
- Test error handling
- Mock game rules, database, and haptics services

**Testing Frameworks:**
- Jest for unit testing
- React Native Testing Library for component testing

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-14 | 1.0 | Story created from Epic 3 | PM Agent |

## Dev Agent Record

### Agent Model Used
_To be populated by Dev Agent_

### Debug Log References
_To be populated by Dev Agent_

### Completion Notes List
_To be populated by Dev Agent_

### File List
_To be populated by Dev Agent_

## QA Results
_To be populated by QA Agent_
